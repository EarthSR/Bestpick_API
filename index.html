<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google and Facebook Sign-In</title>
    <!-- Add Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.14.0/firebase-auth.js"></script>
    <!-- Add Facebook SDK -->
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
</head>
<body>
    <button id="google-sign-in">Sign in with Google</button>
    <button id="facebook-sign-in">Sign in with Facebook</button>

    <!-- Inline script to handle Firebase and Facebook authentication -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCS-ejGDo8O_GMWDgW1xaYT5fjqBXlKjW4",
            authDomain: "apilogin-6efd6.firebaseapp.com",
            projectId: "apilogin-6efd6",
            storageBucket: "apilogin-6efd6.appspot.com",
            messagingSenderId: "741201850844",
            appId: "1:741201850844:web:e3de36b7f7ad5626b29f19",
            measurementId: "G-YX2L16N0JM"
          };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();

        // Function to handle Google sign-in
        async function signInWithGoogle() {
            try {
                const result = await signInWithPopup(auth, googleProvider);
                const token = await result.user.getIdToken();
                const user = result.user;
                console.log('Google User info:', user);
                console.log('Google Token:', token);
                
                const response = await fetch('http://localhost:3000/google-signin', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token: token })
                });
                const data = await response.json();
                console.log('Server response:', data);
            } catch (error) {
                console.error('Google Sign-In Error:', error.message);
            }
        }

        // Attach the function to the Google sign-in button click event
        document.getElementById('google-sign-in').addEventListener('click', signInWithGoogle);

        // Initialize Facebook SDK
        window.fbAsyncInit = function() {
            FB.init({
                appId      : '1021807229429436',
                cookie     : true,
                xfbml      : true,
                version    : 'v20.0'  // Update to the latest version
            });
        };

        // Load the Facebook SDK asynchronously
        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        // Function to handle Facebook sign-in
        function signInWithFacebook() {
            FB.login(function(response) {
                if (response.authResponse) {
                    console.log('Facebook User is authenticated.');
                    handleFacebookSignIn(response.authResponse.accessToken); // Call the async function separately
                } else {
                    console.error('User cancelled login or did not fully authorize.');
                }
            }, { scope: 'public_profile,email' });
        }

        // Asynchronous function to handle server-side authentication
        async function handleFacebookSignIn(token) {
            try {
                console.log('Facebook Token:', token);
                
                const serverResponse = await fetch('http://localhost:3000/facebook-signin', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token: token })
                });
                const data = await serverResponse.json();
                console.log('Server response:', data);
            } catch (error) {
                console.error('Error during server request:', error);
            }
        }

        // Attach the function to the Facebook sign-in button click event
        document.getElementById('facebook-sign-in').addEventListener('click', signInWithFacebook);
    </script>
</body>
</html>
